<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sniper Trades</title>
  <style>
    body {font-family: Arial, sans-serif; padding: 20px; background:#111; color:#eee}
    h1   {color:#2ecc71}
    table{width:100%; border-collapse:collapse; margin-top:20px}
    th,td{border:1px solid #444; padding:8px; text-align:center}
    th   {background:#333}
    tr:nth-child(even){background:#1a1a1a}
    .buy {color:#2ecc71; font-weight:bold}
    .sell{color:#e74c3c; font-weight:bold}
    .filter-container {margin-top:20px;}
    .filter-container label {margin-right:8px;}
    .filter-container select {padding:4px; margin-right:16px; background:#222; color:#eee; border:1px solid #444;}
  </style>
</head>
<body>
  <h1>üìà Sniper Trades (live)</h1>

  <div class="filter-container">
    <label for="filter-status">Status:</label>
    <select id="filter-status">
      <option value="">All</option>
    </select>
  </div>

  <table id="trades">
    <thead>
      <tr>
        <th>Entry Date</th>
        <th>Exit Date</th>
        <th>Symbol</th><th>Type</th><th>Entry</th><th>CMP</th>
        <th>Target</th><th>SL</th><th>PoP</th>
        <th>Status</th><th>P&L (‚Çπ)</th><th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
let tradesData = [];

async function loadTrades() {
  const url = "trades.json?t=" + Date.now();
  const res = await fetch(url, {cache: "no-store"});
  tradesData = await res.json();
  populateStatusFilter();
  renderTable();
}

function populateStatusFilter() {
  const select = document.getElementById('filter-status');
  const statuses = [...new Set(tradesData.map(t => t.status))];
  statuses.sort().forEach(status => {
    const opt = document.createElement('option');
    opt.value = status;
    opt.textContent = status;
    select.appendChild(opt);
  });
}

function renderTable() {
  const statusVal = document.getElementById('filter-status').value;
  const tbody = document.querySelector("#trades tbody");
  const filtered = tradesData.filter(t => {
    return (!statusVal || t.status === statusVal);
  });
  tbody.innerHTML = filtered.length ? filtered.map(tr => `
    <tr>
      <td>${tr.entry_date}</td>
      <td>${tr.exit_date || ''}</td>
      <td>${tr.symbol}</td>
      <td>${tr.type}</td>
      <td>${tr.entry}</td>
      <td>${tr.cmp}</td>
      <td>${tr.target}</td>
      <td>${tr.sl}</td>
      <td>${tr.pop}</td>
      <td>${tr.status}</td>
      <td>${tr.pnl}</td>
      <td class="${tr.action==='Buy'?'buy':'sell'}">${tr.action}</td>
    </tr>
  `).join('') : `<tr><td colspan="12">‚ùå No trades found or failed to load.</td></tr>`;
}

document.getElementById('filter-status').addEventListener('change', renderTable);

loadTrades();
</script>
</body>
</html>
