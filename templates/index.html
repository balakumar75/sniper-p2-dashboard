<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sniper Trades</title>
  <style>
    body { font-family: Arial; background:#111; color:#eee; padding:20px; }
    h1   { color:#2ecc71; }
    select { margin-right:12px; padding:4px 6px; }
    table{ width:100%; border-collapse:collapse; margin-top:14px; font-size:14px;}
    th,td{ border:1px solid #333; padding:6px 8px; text-align:center; }
    th   { background:#222; }
    tr:nth-child(even){ background:#1a1a1a; }
    .buy  { color:#2ecc71; font-weight:bold; }
    .sell { color:#e74c3c;  font-weight:bold; }
    .sector-good { color:#2ecc71; }
    .sector-weak { color:#e0a300; }
    a.chart-link { color:#1e90ff; text-decoration:none; }
  </style>
</head>
<body>
  <h1>üìà Sniper Trades ‚Äî Live Dashboard</h1>

  <!-- üîç Filters -->
  <div>
    <label>Type:
      <select id="fType">
        <option value="all">All</option>
        <option value="Cash">Cash</option>
        <option value="Option Strangle">Option Strangle</option>
      </select>
    </label>
    <label>Action:
      <select id="fAction">
        <option value="all">All</option>
        <option value="Buy">Buy (Long)</option>
        <option value="Sell">Sell (Short)</option>
      </select>
    </label>
    <label>Status:
      <select id="fStatus">
        <option value="all">All</option>
        <option value="Open">Open</option>
        <option value="Target">Target</option>
        <option value="SL">SL</option>
      </select>
    </label>
  </div>

  {% if trades %}
  <table id="tradeTable">
    <thead>
      <tr>
        <th>Date</th><th>Symbol</th><th>Type</th><th>Expiry</th><th>Strike / CMP</th>
        <th>Entry</th><th>Target</th><th>SL</th><th>PoP&nbsp;%</th><th>Sector</th>
        <th>Tags</th><th>Action</th><th>Status</th><th>Exit&nbsp;Date</th>
        <th>Hold&nbsp;Days</th><th>P&L&nbsp;(‚Çπ)</th><th>Chart</th>
      </tr>
    </thead>
    <tbody>
      {% for t in trades %}
      <tr data-type="{{ t.type }}" data-action="{{ t.action }}" data-status="{{ t.status }}">
        <td>{{ t.date }}</td>
        <td>{{ t.symbol }}</td>
        <td>{{ t.type }}</td>
        <td>{{ t.options.expiry if t.options is defined else "‚Äî" }}</td>
        <td>
          {% if t.options is defined %}
            CE {{ t.options.call }} / PE {{ t.options.put }}
          {% else %}
            {{ t.cmp }}
          {% endif %}
        </td>
        <td>{{ t.entry }}</td>
        <td>{{ t.target }}</td>
        <td>{{ t.sl }}</td>
        <td>{{ t.pop_pct }}</td>
        <td class="{% if 'Leader' in t.sector %}sector-good{% elif 'Weak' in t.sector %}sector-weak{% endif %}">
          {{ t.sector }}
        </td>
        <td>{{ t.tags | join(", ") }}</td>
        <td class="{{ 'buy' if t.action == 'Buy' else 'sell' }}">{{ t.action }}</td>
        <td>{{ t.status }}</td>
        <td>{{ t.exit_date }}</td>
        <td>{{ t.holding_days }}</td>
        <td>{{ t.pnl }}</td>
        <td>
          <a class="chart-link"
             href="https://www.tradingview.com/chart/?symbol=NSE:{{ t.symbol }}"
             target="_blank">
             üìä
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p>‚ùå No trades found.</p>
  {% endif %}

  <script>
    const fType = document.getElementById('fType');
    const fAct  = document.getElementById('fAction');
    const fStat = document.getElementById('fStatus');
    const rows  = [...document.querySelectorAll('#tradeTable tbody tr')];

    function applyFilters(){
      rows.forEach(r=>{
        const show =
          (fType.value === 'all'  || r.dataset.type   === fType.value) &&
          (fAct.value  === 'all'  || r.dataset.action === fAct.value) &&
          (fStat.value === 'all'  || r.dataset.status === fStat.value);
        r.style.display = show ? '' : 'none';
      });
    }
    [fType, fAct, fStat].forEach(sel => sel.onchange = applyFilters);
  </script>
</body>
</html>
